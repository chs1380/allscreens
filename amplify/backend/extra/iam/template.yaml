---
AWSTemplateFormatVersion: '2010-09-09'
Description: S3 resource stack creation using Amplify CLI
Parameters:
  storagescreenshotsBucketName:
    Type: String
  env:
    Type: String
  authallscreens6e0c57a0UserPoolId:
    Type: String
  authuserPoolGroupsteachersGroupRole:
    Type: String
  authuserPoolGroupsstudentsGroupRole:
    Type: String
  interactionsvirtualtutorlexBotName:
    Type: String
Conditions:
  ShouldNotCreateEnvResources:
    Fn::Equals:
    - Ref: env
    - NONE
Resources: 
  studentsGroupPolicy:
    Type: AWS::IAM::Policy
    Properties:
      PolicyName: students-group-extra-policy
      Roles:
      - Fn::Join:
        - ''
        - - Ref: authallscreens6e0c57a0UserPoolId
          - "-studentsGroupRole"
      PolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - sumerian:ViewRelease
          - polly:DescribeVoices
          - polly:GetLexicon
          - polly:GetSpeechSynthesisTask
          - polly:ListLexicons
          - polly:ListSpeechSynthesisTasks
          - polly:SynthesizeSpeech
          - transcribe:StartStreamTranscriptionWebSocket
          - comprehend:DetectSentiment
          - comprehend:DetectEntities
          - comprehend:DetectDominantLanguage
          - comprehend:DetectSyntax
          - comprehend:DetectKeyPhrases
          - translate:TranslateText
          Resource:
          - "*"          
        - Effect: Allow
          Action:
          - lex:PostContent
          - lex:PostText
          Resource:
          - !Sub 'arn:aws:lex:${AWS::Region}:${AWS::AccountId}:bot:${interactionsvirtualtutorlexBotName}:*'
          
  teachersGroupPolicy:
    Type: AWS::IAM::Policy
    Properties:
      PolicyName: teacher-group-extra-policy
      Roles:
        - !Sub '${authallscreens6e0c57a0UserPoolId}-teachersGroupRole'
      PolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
            - s3:ListBucket
          Resource:
            - !Sub 'arn:aws:s3:::${storagescreenshotsBucketName}'
        - Effect: Allow
          Action:
            - sqs:SendMessage
          Resource:
            - !Sub "arn:aws:sqs:${AWS::Region}:${AWS::AccountId}:*-CallSqsQueue-*.fifo"     
        - Effect: Allow
          Action:
            - cognito-idp:ListUsersInGroup
            - cognito-idp:ListUsers
            - cognito-idp:GetUser
          Resource:
            - !Sub arn:aws:cognito-idp:${AWS::Region}:${AWS::AccountId}:userpool/${authallscreens6e0c57a0UserPoolId} 
